var StreamEst;!function(e){var t=function(){function e(e,t,r,a){this.$stateProvider=e,this.$urlRouterProvider=t,this.$locationProvider=r,this.$logProvider=a,this.$stateProvider.state("main",{url:"/?workspaceID",template:"<ui-view/>",views:{map:{templateUrl:"Views/mapview.html",controller:"StreamEst.Controllers.MapController"},sidebar:{templateUrl:"Views/sidebarview.html",controller:"StreamEst.Controllers.SidebarController"},navbar:{templateUrl:"Views/navigationview.html",controller:"StreamEst.Controllers.NavbarController"},report:{templateUrl:"Views/reportview.html",controller:"StreamEst.Controllers.ReportController"}}}),this.$urlRouterProvider.otherwise("/"),this.$locationProvider.html5Mode(!0),this.$logProvider.debugEnabled(!1)}return e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider"],e}();angular.module("StreamEst",["ui.router","ui.bootstrap","ui.checkbox","mobile-angular-ui","angulartics","angulartics.google.analytics","toaster","ngAnimate","ngFileUpload","nvd3","leaflet-directive","StreamEst.Services","StreamEst.Controllers","WiM.Services","WiM.Event","wim_angular","daterangepicker"]).config(t)}(StreamEst||(StreamEst={})),Citations=[{title:"Computing Daily Mean Streamflow at Ungaged Locations in Iowa by using the Flow Anywhere and Flow Duration Curve Transfer Statistical Methods",author:"S. Mike Linhart, Jon F. Nania, Curtis L. Sanders, Jr., and Stacey A. Archfield",imgeSrc:"http://pubs.usgs.gov/sir/2012/5232/images/coverthb.gif",src:"http://pubs.usgs.gov/sir/2012/5232/"},{title:"Comparison Between Two Statistically Based Methods, and Two Physically Based Models Developed to Compute Daily Mean Streamflow at Ungaged Locations in the Cedar River Basin, Iowa",author:"S. Mike Linhart, Jon F. Nania, Daniel E. Christiansen, Kasey J. Hutchinson, Curtis L. Sanders, Jr., and Stacey A. Archfield",imgeSrc:"http://pubs.usgs.gov/sir/2013/5111/images/coverthb.gif",src:"http://pubs.usgs.gov/sir/2013/5111/"},{title:"Simulation of daily streamflow for nine river basins in eastern Iowa using the Precipitation-Runoff Modeling System",author:"Adel E. Haj, Daniel E. Christiansen, and Kasey J. Hutchinson ",imgeSrc:"https://pubs.er.usgs.gov/imgsizer/_?f=PNG&u=https%3A%2F%2Fpubs.usgs.gov%2Fsir%2F2015%2F5129%2Fcoverthb.jpg&w=200&s=b%27RmbUzSE0xzgIhCbMUlAqroGXNaE%27",src:"https://pubs.er.usgs.gov/publication/sir20155129"},{"title": "Simulation of daily streamflow for 12 river basins in western Iowa using the Precipitation-Runoff Modeling System","author": "Daniel E. Christiansen, Adel E. Haj, and John C. Risley","imgeSrc": "https://pubs.er.usgs.gov/imgsizer/_?f=PNG&u=https%3A%2F%2Fpubs.usgs.gov%2Fsir%2F2017%2F5091%2Fcoverthb.jpg&w=200&s=b%27A8CNzpy0C76Si4WAORRJgtrVnvs%27","src": "https://pubs.er.usgs.gov/publication/sir20175091"}];var StreamEst;!function(e){var t;!function(e){var t=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=null),this.RegionID=e,this.Pourpoint=t,this.Scenarios=[],this.Features=[],this.computedParametersList=[],this.Disclaimers={},""==this.RegionID||null==this.Pourpoint?this.status=n.e_empty:this.status=n.e_initialized}return Object.defineProperty(e.prototype,"studyAreaType",{get:function(){return a.e_basin},enumerable:!0,configurable:!0}),e}();e.StudyArea=t;var r=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=-1),this.CreatedDate=new Date,this.Disclaimers={},this.Scenarios=[],this.status=n.e_empty}return Object.defineProperty(e.prototype,"studyAreaType",{get:function(){return a.e_segment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Features",{get:function(){for(var e=[],t=0;t<this.Scenarios.length;t++)for(var r=0;r<this.Scenarios[t].SelectedSegmentList.length;r++){var a=this.Scenarios[t].SelectedSegmentList[r];e.push({name:"PRMSSeg_"+a.RiverID+"."+a.SegmentID,feature:a.feature})}return e},enumerable:!0,configurable:!0}),e}();e.SegmentStudyArea=r,function(e){e[e.e_basin=1]="e_basin",e[e.e_segment=2]="e_segment"}(e.StudyAreaType||(e.StudyAreaType={}));var a=e.StudyAreaType;!function(e){e[e.e_empty=0]="e_empty",e[e.e_initialized=1]="e_initialized",e[e.e_ready=2]="e_ready",e[e.e_error=-1]="e_error"}(e.StudyAreaStatus||(e.StudyAreaStatus={}));var n=e.StudyAreaStatus}(t=e.Models||(e.Models={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){var t=function(){function e(){this.append=[],this.remove=[]}return e}();e.WatershedEditDecisionList=t}(t=e.Models||(e.Models={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){var t=function(){function e(){this.status=o.e_initialized,this.SelectedReferenceGage=null,this.ReferenceGageList=[],this.Parameters=[{name:"Drainage Area",description:"Area in square miles",code:"drnarea",unit:"square miles",value:null,limits:{max:7782,min:15.5}},{name:"Mean Annual Precip",description:"Mean Annual Precipitation",code:"precip",unit:"inch",value:null,limits:{max:38.8,min:27.7}},{name:"Relative Stream Density",description:"(First Order Streams * DRNAREA / sum of Stream Lengths ^2)",code:"rsd",unit:"",value:null,limits:{max:.49,min:.22}},{name:"Hydrograph Separation Analysis",description:"Percent of area covered by Hydrograph Separation",code:"hysep",unit:"percent",value:null,limits:{max:78,min:20.3}},{name:"Stream Variability Index",description:"Streamflow Variability Index",code:"stream_varg",unit:"",value:null,limits:{max:.76,min:.21}},{name:"Percent Area Soil Type B",description:"Percent of area in hydric soil 'B' defined by SSURGO",code:"SSURGOB",unit:"percent area",value:null,limits:{max:99.4,min:5.7}},{name:"Percent Area Soil Type C",description:"Percent of area in hydric soil 'C' defined by SSURGO",code:"SSURGOC",unit:"percent area",value:null,limits:{max:83.5,min:.09}},{name:"Percent Area Soil Type D",description:"Percent of area in hydric soil 'D' defined by SSURGO",code:"SSURGOD",unit:"percent area",value:null,limits:{max:57,min:0}}],this.Disclaimers={}}return Object.defineProperty(e.prototype,"name",{get:function(){return"Flow Duration Curve Transfer Method"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"code",{get:function(){return"FDCTM"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hint",{get:function(){return"QPPQ method"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return n.e_statistic},enumerable:!0,configurable:!0}),e}();e.FDCTMScenario=t;var r=function(){function e(){this.status=o.e_initialized,this.SelectedReferenceGage=null,this.ReferenceGageList=[],this.Parameters=[{name:"Drainage Area",description:"Area in square miles",code:"drnarea",unit:"square miles",value:null,limits:{max:4310,min:34.3}}],this.Disclaimers={},this.result={}}return Object.defineProperty(e.prototype,"name",{get:function(){return"Flow Anywhere"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"code",{get:function(){return"FLA"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hint",{get:function(){return"Modified drainage area method"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return n.e_statistic},enumerable:!0,configurable:!0}),e}();e.FAScenario=r;var a=function(){function e(){this.status=o.e_initialized,this.SelectedSegmentList=[],this.Disclaimers={},this.result={}}return Object.defineProperty(e.prototype,"name",{get:function(){return"Precipitation-Runoff Modeling System"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"code",{get:function(){return"PRMS"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hint",{get:function(){return"PRMS method"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return n.e_physical},enumerable:!0,configurable:!0}),e}();e.PRMSScenario=a,function(e){e[e.e_statistic=1]="e_statistic",e[e.e_physical=2]="e_physical"}(e.ScenarioType||(e.ScenarioType={}));var n=e.ScenarioType;!function(e){e[e.e_initialized=0]="e_initialized",e[e.e_loaded=9]="e_loaded",e[e.e_complete=10]="e_complete",e[e.e_error=-1]="e_error"}(e.ScenarioStatus||(e.ScenarioStatus={}));var o=e.ScenarioStatus}(t=e.Models||(e.Models={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){var t=function(){function e(e,t,r,a,n){void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),void 0===a&&(a=""),void 0===n&&(n=NaN),this.name=e,this.code=t,this.description=r,this.unit=a,this.value=n}return e}();e.Parameter=t}(t=e.Models||(e.Models={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){var t=function(){function e(e,t){this.StationID=e,this.Name=t}return e}();e.ReferenceGage=t}(t=e.Models||(e.Models={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){var t=function(){function e(){}return e.FromJSON=function(t){var a=new e;a.Name=t.hasOwnProperty("Name")?t.Name:null,a.SeriesID=t.hasOwnProperty("SeriesID")?t.SeriesID:null,a.SeriesDescription=t.hasOwnProperty("SeriesDescription")?t.SeriesDescription:null,a.ValueMax=t.hasOwnProperty("ValueMax")?t.ValueMax:null,a.ValueMin=t.hasOwnProperty("ValueMin")?t.ValueMin:null,a.StartDate=t.hasOwnProperty("StartDate")?new Date(t.StartDate):null,a.EndDate=t.hasOwnProperty("EndDate")?new Date(t.EndDate):null,a.ValueUnits=t.hasOwnProperty("ValueUnits")?t.ValueUnits:null;var n=t.hasOwnProperty("Observations")?t.Observations:null;return null!=n&&(a.Observations=[],n.forEach(function(e){return a.Observations.push(r.FromJSON(e))})),a},e}();e.TimeSeries=t;var r=function(){function e(e,t,r){this.Date=e,this.Value=t,this.Code=r}return e.FromJSON=function(t){var r=t.hasOwnProperty("Date")?new Date(t.Date):null,a=t.hasOwnProperty("Value")?t.Value:-9999,n=t.hasOwnProperty("DataCode")?t.DataCode:null;return new e(r,a,n)},e}();e.TimeSeriesObservation=r}(t=e.Models||(e.Models={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){var t=function(){function e(e,t,a,n,o,i){void 0===t&&(t=r.e_info),void 0===a&&(a=""),void 0===n&&(n=!1),void 0===o&&(o=5e3),void 0===i&&(i=null),this.type=this.getType(t),this.title=a,this.timeout=o,this.toastId=i,this.showCloseButton=n,this.body=e}return e.prototype.getType=function(e){switch(e){case r.e_error:return"error";case r.e_info:return"info";case r.e_success:return"success";case r.e_wait:return"wait";case r.e_warning:return"warning"}},e}();e.Notification=t,function(e){e[e.e_error=-1]="e_error",e[e.e_info=0]="e_info",e[e.e_wait=1]="e_wait",e[e.e_success=2]="e_success",e[e.e_warning=3]="e_warning"}(e.NotificationType||(e.NotificationType={}));var r=e.NotificationType}(t=e.Models||(e.Models={}))}(StreamEst||(StreamEst={})),function(){"use strict";angular.module("StreamEst.Services",[])}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamEst;!function(e){var t;!function(t){"use strict";function r(e,t,r){return new n(e,t,r)}t.onSelectedStudyAreaChanged="onSelectedStudyAreaChanged",t.onStudyAreaDoInit="onStudyAreaDoInit",t.onStudyAreaLoadComplete="onStudyAreaLoadComplete",t.onStudyAreaRemoved="onStudyAreaRemoved",t.onStudyAreaExcecuteComplete="onStudyAreaExcecuteComplete";var a=function(e){function t(){e.call(this)}return __extends(t,e),t}(WiM.Event.EventArgs);t.StudyAreaEventArgs=a;var n=function(r){function n(e,a,n){r.call(this,e,configuration.baseurls.StreamStats),this.$http=e,this._busyCount=0,this._studyAreas={},this.eventmanager=a,this.modalservice=n,this.init(),a.AddEvent(t.onSelectedStudyAreaChanged),a.AddEvent(t.onStudyAreaRemoved),a.AddEvent(t.onStudyAreaLoadComplete),a.AddEvent(t.onStudyAreaExcecuteComplete)}return __extends(n,r),Object.defineProperty(n.prototype,"isBusy",{get:function(){return this._busyCount>0?!0:(this._busyCount=0,!1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"studyAreas",{get:function(){return this._studyAreas},enumerable:!0,configurable:!0}),n.prototype.addStudyArea=function(e,t){return this.containsStudyArea(e)?!1:(this._studyAreas[e]=t,!0)},n.prototype.removeStudyArea=function(e){return this.containsStudyArea(e)&&delete this._studyAreas[e],!0},n.prototype.getStudyArea=function(e){return this.containsStudyArea(e)?this._studyAreas[e]:null},n.prototype.containsStudyArea=function(e){return e in this._studyAreas?!0:!1},n.prototype.addScenario=function(e){var t=this.getStudyAreaType(e.type),r=this.getStudyArea(t);null==r&&(r=this.addStudyAreaByType(t)),r.Scenarios.push(e)},n.prototype.scenarioExists=function(e){var t=this.getStudyAreaType(e.type),r=this.getStudyArea(t);if(null==r)return!1;var a=r.Scenarios.indexOf(e);return a>-1?!0:!1},n.prototype.removeScenario=function(e){var t=this.getStudyAreaType(e.type),r=this.getStudyArea(t);if(null!=r){var a=r.Scenarios.indexOf(e);0>a||r.Scenarios.splice(a,1)}},n.prototype.initializeStudyArea=function(r){var n=this,o=this.getStudyArea(r);switch(r){case e.Models.StudyAreaType.e_basin:var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSdelineation.format("geojson",o.RegionID,o.Pourpoint.Longitude.toString(),o.Pourpoint.Latitude.toString(),o.Pourpoint.crs.toString(),!1),s=new WiM.Services.Helpers.RequestInfo(i,!0);this.Execute(s).then(function(t){o.Disclaimers.Server=t.headers()["usgswim-hostname"],t.data.hasOwnProperty("messages")&&(o.Disclaimers.DelineationMessages=t.data.messages),t.data.hasOwnProperty("featurecollection")&&(t.data.featurecollection.forEach(function(e){o.Features.push(e)}),o.status=e.Models.StudyAreaStatus.e_initialized),o.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null},function(t){o.status=e.Models.StudyAreaStatus.e_error,o.Disclaimers.error="Delineation Error"})["finally"](function(){var e=new a;e.studyArea=o,n.eventmanager.RaiseEvent(t.onSelectedStudyAreaChanged,n,e)});break;case e.Models.StudyAreaType.e_segment:}},n.prototype.loadStudyArea=function(r){var n=this;try{var o=new e.Models.StudyArea;switch(o.status=e.Models.StudyAreaStatus.e_initialized,this.addStudyArea(o.studyAreaType,o),o.studyAreaType){case e.Models.StudyAreaType.e_basin:var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSwatershedByWorkspace.format("geojson","IA",r,4326),s=new WiM.Services.Helpers.RequestInfo(i,!0);this.Execute(s).then(function(t){o.Features=t.data.hasOwnProperty("featurecollection")?t.data.featurecollection:null,o.WorkspaceID=t.data.hasOwnProperty("workspaceID")?t.data.workspaceID:null,o.RegionID="IA",o.CreatedDate=new Date,o.Features.forEach(function(e){var t=angular.fromJson(angular.toJson(e));if("globalwatershedpoint"==t.name){var r=t.feature.features[0].bbox;return void(o.Pourpoint=new WiM.Models.Point(r[1],r[0],t.feature.crs.properties.code))}}),o.status=e.Models.StudyAreaStatus.e_initialized},function(t){o.status=e.Models.StudyAreaStatus.e_error,o.Disclaimers.error="Delineation Error"})["finally"](function(){var e=new a;e.studyArea=o,n.eventmanager.RaiseEvent(t.onSelectedStudyAreaChanged,n,e)})}}catch(u){return}},n.prototype.getstudyAreaFeatures=function(e){var t=[];for(var r in this.studyAreas)if(this.studyAreas.hasOwnProperty(r)&&this.studyAreas[r].Features.length>0)for(var a=0;a<this.studyAreas[r].Features.length;a++)this.studyAreas[r].Features[a].name==e&&t.push(this.studyAreas[r].Features[a]);return t},n.prototype.loadScenarios=function(){if(!this.isBusy){var r=this.studyAreas;if(0!==Object.keys(r).length)for(var n in r)r[n].studyAreaType==e.Models.StudyAreaType.e_basin&&this.loadParameters(r[n]),r[n].studyAreaType==e.Models.StudyAreaType.e_basin&&this.loadReferenceGage(r[n]),r[n].studyAreaType==e.Models.StudyAreaType.e_segment&&(r[n].status=e.Models.StudyAreaStatus.e_ready,this.isBusy||this.eventmanager.RaiseEvent(t.onStudyAreaLoadComplete,this,a.Empty))}},n.prototype.verifyScenariosStatus=function(t){var r=this.studyAreas;if(0!==Object.keys(r).length){for(var a in r){if(r[a].status!=e.Models.StudyAreaStatus.e_ready)return!1;r[a].Scenarios.forEach(function(r){return t==e.Models.ScenarioStatus.e_loaded&&(r.status<=e.Models.ScenarioStatus.e_initialized||r.status==e.Models.ScenarioStatus.e_error)?!1:t!=r.status?!1:void 0})}return!0}},n.prototype.computeScenarios=function(t,r){var a=this;if(!this.isBusy){var n=this.studyAreas;if(0!==Object.keys(n).length)for(var o in n){if(n[o].status!=e.Models.StudyAreaStatus.e_ready)return;n[o].Scenarios.forEach(function(e){e.startDate=t,e.endDate=r,("FDCTM"==e.code||"FLA"==e.code)&&a.computeScenario(e),"PRMS"==e.code&&a.computePRMSScenario(e)})}}},n.prototype.refreshParameter=function(t){var r=this.getStudyArea(e.Models.StudyAreaType.e_basin),a=r.computedParametersList.indexOf(t),n=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(r.RegionID,r.WorkspaceID,t.code),o=new WiM.Services.Helpers.RequestInfo(n,!0);this.Execute(o).then(function(t){if(t.data.hasOwnProperty("messages")&&(r.Disclaimers.ParameterMessages=t.data.messages),t.data.hasOwnProperty("parameters")){var n=t.data.parameters.map(function(t){return new e.Models.Parameter(t.name,t.code,t.description,t.unit,t.value)});if(0>a)return;r.computedParametersList[a].value=n[0].value,r.computedParametersList[a].isbusy=!1,r.Scenarios.forEach(function(e){if(e.hasOwnProperty("Parameters"))for(var r=0;r<e.Parameters.length;r++)for(var a=e.Parameters[r],n=0;n<t.data.parameters.length;n++){var o=t.data.parameters[n];if(o.code.toUpperCase()===a.code.toUpperCase()){a.value=o.value;break}}})}},function(t){r.status=e.Models.StudyAreaStatus.e_error,r.Disclaimers.error="Delineation Error"})["finally"](function(){})},n.prototype.removePRMSSegment=function(t){var r=this.getStudyArea(e.Models.StudyAreaType.e_segment);if(null!=r){var a=r.Scenarios[0].SelectedSegmentList.indexOf(t);0>a||(r.Scenarios[0].SelectedSegmentList.splice(a,1),this.eventmanager.RaiseEvent(WiM.Directives.onLayerChanged,this,new WiM.Directives.LegendLayerChangedEventArgs("PRMSSeg_"+t.RiverID+"."+t.SegmentID,"visible",!1)))}},n.prototype.init=function(){this.loadPRMSNameLookup()},n.prototype.addStudyAreaByType=function(r){var a;switch(r){case e.Models.StudyAreaType.e_basin:a=new e.Models.StudyArea;break;case e.Models.StudyAreaType.e_segment:a=new e.Models.SegmentStudyArea}return this.modalservice.openModal(t.SSModalType.e_selectstudyarea),this.addStudyArea(r,a),a},n.prototype.getStudyAreaType=function(t){switch(t){case 1:return e.Models.StudyAreaType.e_basin;case 2:return e.Models.StudyAreaType.e_segment;default:return null}},n.prototype.loadParameters=function(r){var n=this;this._busyCount++;var o=[];r.Scenarios.forEach(function(e){e.hasOwnProperty("Parameters")&&e.Parameters.map(function(e){o.indexOf(e.code)<0&&o.push(e.code)})});var i=configuration.baseurls.StreamStatsServices+configuration.queryparams.SSComputeParams.format(r.RegionID,r.WorkspaceID,o.join(";")),s=new WiM.Services.Helpers.RequestInfo(i,!0);this.Execute(s).then(function(t){t.data.hasOwnProperty("messages")&&(r.Disclaimers.ParameterMessages=t.data.messages),t.data.hasOwnProperty("parameters")&&(r.computedParametersList=t.data.parameters.map(function(t){return new e.Models.Parameter(t.name,t.code,t.description,t.unit,t.value)}),r.Scenarios.forEach(function(e){if(e.hasOwnProperty("Parameters"))for(var r=0;r<e.Parameters.length;r++)for(var a=e.Parameters[r],n=0;n<t.data.parameters.length;n++){var o=t.data.parameters[n];if(o.code.toUpperCase()===a.code.toUpperCase()){a.value=o.value;break}}}))},function(t){r.status=e.Models.StudyAreaStatus.e_error,r.Disclaimers.error="Delineation Error"})["finally"](function(){n._busyCount--,n.isBusy||(r.status=e.Models.StudyAreaStatus.e_ready,n.eventmanager.RaiseEvent(t.onStudyAreaLoadComplete,n,a.Empty))})},n.prototype.loadReferenceGage=function(r){var n=this,o="";r.Scenarios.forEach(function(i){if(n._busyCount++,i.hasOwnProperty("ReferenceGageList")&&i.hasOwnProperty("SelectedReferenceGage")){switch(i.code){case"FDCTM":o=configuration.baseurls.Service,o+=configuration.queryparams.KrigService.format(r.RegionID,r.Pourpoint.Longitude,r.Pourpoint.Latitude,r.Pourpoint.crs);break;case"FLA":o=configuration.baseurls.GISserver,o+=configuration.queryparams.FARefGage.format("{"+"x:{0},y:{1}".format(r.Pourpoint.Longitude.toString(),r.Pourpoint.Latitude.toString())+"}",r.Pourpoint.crs)}var s=new WiM.Services.Helpers.RequestInfo(o,!0);n.Execute(s).then(function(t){var r=t.data;switch(i.code){case"FDCTM":i.ReferenceGageList=[];for(var a=0;a<r.length;a++){var n=new e.Models.ReferenceGage(r[a].ID,r[a].Name);n.DrainageArea_sqMI=r[a].DrainageArea,n.correlation=r[a].Correlation,i.ReferenceGageList.push(n),i.SelectedReferenceGage=i.ReferenceGageList[0]}break;case"FLA":i.ReferenceGageList=[];for(var a=0;a<r.features.length;a++){var o=r.features[a].attributes,n=new e.Models.ReferenceGage(o["reference_gages.site_id"],o["reference_gages.site_name"]);n.DrainageArea_sqMI=o["reference_gages.da_gis_mi2"],i.ReferenceGageList.push(n),i.SelectedReferenceGage=i.ReferenceGageList[0],i.regionID=o["regions_local.Region_Agg"]}}i.status++},function(t){r.status=e.Models.StudyAreaStatus.e_error,r.Disclaimers.error="Delineation Error"})["finally"](function(){n._busyCount--,n.isBusy||(r.status=e.Models.StudyAreaStatus.e_ready,n.eventmanager.RaiseEvent(t.onStudyAreaLoadComplete,n,a.Empty))})}})},n.prototype.computeScenario=function(r){var n=this;this._busyCount++;var o="",i={};switch(r.code){case"FDCTM":o=configuration.baseurls.Service+configuration.queryparams.RegressionScenarios.format(r.code),i.startdate=r.startDate,i.enddate=r.endDate,i.nwis_station_id=r.SelectedReferenceGage.StationID,i.parameters=r.Parameters.map(function(e){return{code:e.code,value:e.value}});break;case"FLA":o=configuration.baseurls.Service+configuration.queryparams.RegressionScenarios.format(r.code),i.startdate=r.startDate,i.enddate=r.endDate,i.nwis_station_id=r.SelectedReferenceGage.StationID,i.parameters=r.Parameters.map(function(e){return{code:e.code,value:e.value}}),i.region=3}var s=new WiM.Services.Helpers.RequestInfo(o,!0,WiM.Services.Helpers.methodType.POST,"json",angular.toJson(i));this.Execute(s).then(function(t){r.result=t.data,r.status=e.Models.ScenarioStatus.e_complete},function(t){r.status=e.Models.ScenarioStatus.e_error,r.Disclaimers.error="Execution Error"})["finally"](function(){n._busyCount--,n.isBusy||n.eventmanager.RaiseEvent(t.onStudyAreaExcecuteComplete,n,a.Empty)})},n.prototype.computePRMSScenario=function(r){var n=this,o=moment(r.startDate).format("YYYY-MM-DD")+" 00:00:00",i=moment(r.endDate).format("YYYY-MM-DD")+" 00:00:00",s=r.SelectedSegmentList.group("RiverID");r.result={},r.result.EstimatedFlow={},angular.forEach(s,function(s,u){n._busyCount++;var l="",c={},d=Number(u)+42,p=s.map(function(e){return"nsegment = "+e.SegmentID}).join(" OR ");c.where="({0}) AND (date'{1}' <= tstamp AND tstamp <= date'{2}')".format(p,o,i),c.outFields="segment_cf,nsegment,tstamp_str,tstamp",c.returnDistinctValues=!1,c.f="pjson",l=configuration.regions.IA.PRMS.url+"/{0}/query".format(d.toString());var y=new WiM.Services.Helpers.RequestInfo(l,!0,WiM.Services.Helpers.methodType.POST,"json",c,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);n.Execute(y).then(function(t){console.log(u,l);var a=t.data.features.map(function(t){return new e.Models.TimeSeriesObservation(new Date(t.attributes.tstamp_str),t.attributes.segment_cf,t.attributes.nsegment)}).group("Code"),o=[];for(var i in a){var s=new e.Models.TimeSeries;s.Name="Seg: "+u+"."+i+", PRMS "+n.prmsNameLookup[u],s.SeriesDescription="Estimates computed using Precipitation-Runoff Modeling System.",s.StartDate=r.startDate,s.EndDate=r.endDate,s.Observations=a[i],o.push(s)}r.result.EstimatedFlow[n.prmsNameLookup[u]]=o},function(t){r.status=e.Models.ScenarioStatus.e_error,r.Disclaimers.error="Execution Error"})["finally"](function(){n._busyCount--,n.isBusy||(r.status=e.Models.ScenarioStatus.e_complete,n.eventmanager.RaiseEvent(t.onStudyAreaExcecuteComplete,n,a.Empty))})})},n.prototype.loadPRMSNameLookup=function(){var e=this,t=configuration.regions.IA.PRMS.url+"?f=pjson",r=new WiM.Services.Helpers.RequestInfo(t,!0);this.Execute(r).then(function(t){e.prmsNameLookup={},t.data.layers.forEach(function(t){e.prmsNameLookup[t.id]=t.name})},function(t){e.prmsNameLookup={0:"One Hundred and Two River",1:"Boyer River",2:"Big Sioux River",3:"Chariton River",4:"Des Moines River",5:"Floyd River",6:"Fox River",7:"Iowa River",8:"Keg River",9:"Little Sioux River",10:"Maquoketa River",11:"Moana-Harrison Ditch",12:"Nishnabotna River",13:"Nodaway River",14:"Fox River",15:"Soldier River",16:"Thompson River",17:"Turkey River",18:"Upper Iowa River",19:"Wapsipinicon River",20:"Yellow River"}})},n.prototype.onStudyAreaChanged=function(e,t){},n}(WiM.Services.HTTPServiceBase);r.$inject=["$http","WiM.Event.EventManager","StreamEst.Services.ModalService"],angular.module("StreamEst.Services").factory("StreamEst.Services.StudyAreaService",r)}(t=e.Services||(e.Services={}))}(StreamEst||(StreamEst={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamEst;!function(e){var t;!function(e){"use strict";function t(e,t){return new r(e,t)}var r=function(e){function t(t,r){e.call(this,t,configuration.baseurls.StreamStats),this.$q=r,this.drawElevationProfile=!1,this.drawMeasurement=!1,this.showElevationChart=!1,this.allowStreamgageQuery=!1,this.measurementData=""}return __extends(t,e),t.prototype.elevationProfile=function(e){var t=this,r="http://elevation.arcgis.com/arcgis/rest/services/Tools/ElevationSync/GPServer/Profile/execute",a=new WiM.Services.Helpers.RequestInfo(r,!0,WiM.Services.Helpers.methodType.POST,"json",{InputLineFeatures:e,returnZ:!0,f:"json"},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},WiM.Services.Helpers.paramsTransform);this.Execute(a).then(function(e){var r=e.data.results[0].value.features[0].geometry.paths[0];r.length>0&&(t.elevationProfileGeoJSON={name:"NewFeatureType",type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:r},properties:""}]})},function(e){})["finally"](function(){})},t}(WiM.Services.HTTPServiceBase);t.$inject=["$http","$q"],angular.module("StreamEst.Services").factory("StreamEst.Services.ExplorationService",t)}(t=e.Services||(e.Services={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){"use strict";function t(e){return new r(e)}var r=function(){function e(e){this.modal=e}return e.prototype.openModal=function(e,t){void 0===t&&(t=null),this.modalOptions=t,this.modal.open(this.getModalSettings(e))},e.prototype.getModalSettings=function(e){try{switch(e){case a.e_report:return{templateUrl:"Views/reportview.html",controller:"StreamEst.Controllers.ReportController",size:"lg",backdropClass:"backdropZ",windowClass:"windowZ"};case a.e_about:return{templateUrl:"Views/about.html",controller:"StreamEst.Controllers.AboutController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};case a.e_selectstudyarea:return{templateUrl:"Views/selectstudyareaview.html",controller:"StreamEst.Controllers.SelectStudyAreaController",size:"lg",backdropClass:"backdropZ",backdrop:"static",windowClass:"windowZ"};default:return!1}}catch(t){return!1}},e}();!function(e){e[e.e_report=1]="e_report",e[e.e_about=2]="e_about",e[e.e_selectstudyarea=3]="e_selectstudyarea"}(e.SSModalType||(e.SSModalType={}));var a=e.SSModalType;t.$inject=["$modal"],angular.module("StreamEst.Services").factory("StreamEst.Services.ModalService",t)}(t=e.Services||(e.Services={}))}(StreamEst||(StreamEst={})),function(){"use strict";angular.module("StreamEst.Controllers",[])}();var StreamEst;!function(e){var t;!function(t){"use strict";var r=function(){function e(){this.lat=0,this.lng=0}return e}(),a=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),n=(function(){function e(e,t,r,a,n){void 0===n&&(n=void 0),this.name=e,this.url=t,this.type=r,this.visible=a,this.layerOptions=n}return e}(),function(){function e(e,t,r){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=!0),this.maxZoom=e,this.minZoom=t,this.zoomControl=r}return e}()),o=function(){function t(t,r,a,n,o,i,s,u,l,c,d,p){var y=this;this.$scope=t,this.toaster=p,this.center=null,this.layers=null,this.mapDefaults=null,this.mapPoint=null,this.bounds=null,this.markers=null,this.geojson=null,this.events=null,this.layercontrol=null,this.regionLayer=null,this.doDelineate=!1,this.doQueryPRMSSegments=!1,t.vm=this,this.init(),this.$compile=r,this.angulartics=a,this.searchService=u,this.$locationService=n,this.leafletBoundsHelperService=i,this.leafletData=s,this.studyAreaService=l,this.explorationService=c,this.eventManager=d,this.eventManager.SubscribeToEvent(e.Services.onSelectedStudyAreaChanged,new WiM.Event.EventHandler(function(e,t){y.onSelectedStudyAreaChanged(e,t)})),this.eventManager.SubscribeToEvent(e.Services.onStudyAreaDoInit,new WiM.Event.EventHandler(function(e,t){y.onStudyAreaDoInit(e,t)})),this.eventManager.SubscribeToEvent(WiM.Directives.onLayerChanged,new WiM.Event.EventHandler(function(e,t){y.onLayerChanged(e,t)})),this.eventManager.SubscribeToEvent(WiM.Services.onSelectedAreaOfInterestChanged,new WiM.Event.EventHandler(function(e,t){y.onSelectedAreaOfInterestChanged(e,t)})),t.$on("leafletDirectiveMap.mousemove",function(e,t){var r=t.leafletEvent.latlng;y.mapPoint.lat=r.lat,y.mapPoint.lng=r.lng}),t.$on("leafletDirectiveMap.drag",function(e,t){y.cursorStyle="grabbing"}),t.$on("leafletDirectiveMap.dragend",function(e,t){y.doDelineate||y.doQueryPRMSSegments?y.cursorStyle="crosshair":y.cursorStyle="pointer"}),t.$on("leafletDirectiveMap.zoomend",function(e,t){(y.doDelineate||y.doQueryPRMSSegments)&&(y.cursorStyle="crosshair")}),t.$on("leafletDirectiveMap.click",function(e,t){y.doDelineate&&y.checkDelineatePoint(t.leafletEvent.latlng),y.doQueryPRMSSegments&&y.checkPRMSSegment(t.leafletEvent.latlng),c.allowStreamgageQuery&&y.queryStreamgages(t.leafletEvent)}),t.$watch(function(){return y.explorationService.elevationProfileGeoJSON},function(e,t){e&&y.displayElevationProfile()}),t.$watch(function(){return y.explorationService.drawElevationProfile},function(e,t){e&&y.elevationProfile()}),t.$watch(function(){return y.explorationService.drawMeasurement},function(e,t){e&&y.measurement()}),t.$watch(function(){return y.doDelineate||y.doQueryPRMSSegments},function(e,t){return e?y.cursorStyle="crosshair":y.cursorStyle="pointer"}),t.$watch(function(){return y.center.zoom},function(e,t){switch(e){case 19:y._mapScale="1,128";break;case 18:y._mapScale="2,256";break;case 17:y._mapScale="4,513";break;case 16:y._mapScale="9,027";break;case 15:y._mapScale="18,055";break;case 14:y._mapScale="36,111";break;case 13:y._mapScale="72,223";break;case 12:y._mapScale="144,447";break;case 11:y._mapScale="288,895";break;case 10:y._mapScale="577,790";break;case 9:y._mapScale="1,155,581";break;case 8:y._mapScale="2,311,162";break;case 7:y._mapScale="4,622,324";break;case 6:y._mapScale="9,244,649";break;case 5:y._mapScale="18,489,298";break;case 4:y._mapScale="36,978,596";break;case 3:y._mapScale="73,957,193";break;case 2:y._mapScale="147,914,387";break;case 1:y._mapScale="295,828,775";break;case 0:y._mapScale="591,657,550"}}),o.workspaceID&&this.studyAreaService.loadStudyArea(o.workspaceID)}return Object.defineProperty(t.prototype,"mapScale",{get:function(){return this._mapScale},enumerable:!0,configurable:!0}),t.prototype.removeStudyArea=function(){confirm("This will remove the Study area and contained scenarios. Select OK to proceed.")&&(this.studyAreaService.removeStudyArea(e.Models.StudyAreaType.e_basin),this.removeGeoJson("globalwatershed",!0),this.eventManager.RaiseEvent(e.Services.onStudyAreaRemoved,this,e.Services.StudyAreaEventArgs.Empty))},t.prototype.init=function(){this.center=new a(42,-93,8),this.layers={baselayers:configuration.basemaps,overlays:configuration.overlayedLayers},this.mapDefaults=new n(null,8,!0),this.markers={},this.geojson={},this.regionLayer={},this.controls={scale:!0,draw:{draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,marker:!1}},custom:new Array(L.control.locate({follow:!1,locateOptions:{maxZoom:15}}),L.control.elevation({imperial:!0}))},this.events={map:{enable:["mousemove","zoomend","click"]}},this.mapPoint=new r,L.Icon.Default.imagePath="images";
},t.prototype.initiateStreamgageQuery=function(){this.explorationService.allowStreamgageQuery=!this.explorationService.allowStreamgageQuery},t.prototype.queryStreamgages=function(t){var r=this;this.sm("Querying streamgages, Please wait...",e.Models.NotificationType.e_wait,"Streamgage Query",!0,321,0),this.cursorStyle="wait",this.markers={},this.angulartics.eventTrack("explorationTools",{category:"Map",label:"queryStreamgages"}),this.leafletData.getMap().then(function(a){r.leafletData.getLayers().then(function(n){if(a.getZoom()<=8)return r.cursorStyle="pointer",r.clrm(321),void r.sm("You must be at Zoom Level 9 or greater to query streamgages",e.Models.NotificationType.e_warning,"Streamgage Query");var o;n.overlays.SSLayer.identify().on(a).at(t.latlng).returnGeometry(!1).tolerance(5).layers(o).run(function(n,o){return r.clrm(321),r.cursorStyle="pointer",o.features&&0!=o.features.length?void o.features.forEach(function(e){var n="",o=["latitude","longitude","sta_id","sta_name","featureurl","drnarea"];angular.forEach(e.properties,function(e,t){if(-1!=o.indexOf(t))if("featureurl"==t){e.split("site_no=")[1];n+='<strong>NWIS page: </strong><a href="'+e+' "target="_blank">link</a></br>'}else n+="<strong>"+t+": </strong>"+e+"</br>"}),r.markers.regionalQueryResult={lat:t.latlng.lat,lng:t.latlng.lng,message:n,focus:!0,draggable:!1},a.panBy([0,1]),r.clrm(321)}):void r.sm("No streamgages wer found",e.Models.NotificationType.e_info,"Streamgage Query")})})})},t.prototype.elevationProfile=function(){var t=this;document.getElementById("measurement-div").innerHTML="",this.explorationService.measurementData="",this.explorationService.showElevationChart=!0;var r;this.controls.custom.forEach(function(e){e._container.className.indexOf("elevation")>-1&&(r=e)}),this.angulartics.eventTrack("explorationTools",{category:"Map",label:"elevationProfile"}),this.leafletData.getMap().then(function(a){t.leafletData.getLayers().then(function(n){var o=n.overlays.draw;o.clearLayers(),t.drawController({metric:!1},!0),delete t.geojson.elevationProfileLine3D,a.on("draw:drawstart",function(e){r.clear()}),a.on("draw:created",function(r){a.removeEventListener("draw:created");var n=r.layer.toGeoJSON(),o='{"geometryType":"esriGeometryPolyline","spatialReference":{"wkid":"4326"},"fields": [],"features":[{"geometry": {"type":"polyline", "paths":['+JSON.stringify(n.geometry.coordinates)+"]}}]}";t.cursorStyle="wait",t.sm("Querying the elevation service. Please wait...",e.Models.NotificationType.e_wait,"Elevation Query",!0,441,0),t.explorationService.elevationProfile(o),t.explorationService.drawElevationProfile=!1,a.panBy([0,1])})})})},t.prototype.drawController=function(e,t){var r=this;return t?void this.leafletData.getMap().then(function(t){r.drawControl=new L.Draw.Polyline(t,e),r.drawControl.enable()}):(this.drawControl.disable(),void(this.drawControl=void 0))},t.prototype.displayElevationProfile=function(){var e;this.controls.custom.forEach(function(t){t._container&&t._container.className.indexOf("elevation")>-1&&(e=t)}),this.geojson.elevationProfileLine3D={data:this.explorationService.elevationProfileGeoJSON,style:{color:"#ff7800",weight:5,opacity:.65},onEachFeature:e.addData.bind(e)},this.leafletData.getMap().then(function(t){var r=e.onAdd(t);document.getElementById("elevation-div").innerHTML="",document.getElementById("elevation-div").appendChild(r)}),this.clrm(441),this.cursorStyle="pointer"},t.prototype.showLocation=function(){var e;this.controls.custom.forEach(function(t){t._container.className.indexOf("leaflet-control-locate")>-1&&(e=t)}),e.start()},t.prototype.resetMap=function(){this.center=new a(42,-93,8)},t.prototype.resetExplorationTools=function(){document.getElementById("elevation-div").innerHTML="",document.getElementById("measurement-div").innerHTML="",this.drawControl&&this.drawController({},!1),this.explorationService.allowStreamgageQuery=!1,this.explorationService.drawMeasurement=!1,this.explorationService.measurementData="",this.explorationService.drawElevationProfile=!1,this.explorationService.showElevationChart=!1},t.prototype.measurement=function(){var e=this;document.getElementById("elevation-div").innerHTML="",this.explorationService.measurementData="Click the map to begin\nDouble click to end the Drawing",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"measurement"}),this.leafletData.getMap().then(function(t){e.leafletData.getLayers().then(function(r){var a=!1;e.drawController({shapeOptions:{color:"blue"},metric:!1},!0);var n=r.overlays.draw;n.clearLayers();var o=function(){e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString()},i=function(){0==a&&(a=!0,e.explorationService.measurementData="Total Length: ",t.on("mousemove",o))},s=function(r){var a=r.layer;n.addLayer(a),n.addTo(t),e.explorationService.measurementData="Total length: "+e.drawControl._getMeasurementString(),t.off("click",i),t.off("mousemove",o),t.off("draw:created",s),e.drawControl.disable(),e.explorationService.drawMeasurement=!1};t.on("click",i),t.on("draw:created",s)})})},t.prototype.checkDelineatePoint=function(t){return this.center.zoom<15?void this.sm("Please zoom to zoom level of 15 to perform this operation.",e.Models.NotificationType.e_warning):(this.sm("Delineating study area. Please wait.....",e.Models.NotificationType.e_wait,"",!0,579,0),this.cursorStyle="wait",this.markers={},this.markers.pourpoint={lat:t.lat,lng:t.lng,message:"Delineating your click point.</br>Please wait....</br><strong>Latitude: </strong>"+t.lat.toFixed(5)+"</br><strong>Longitude: </strong>"+t.lng.toFixed(5)+'</br><i class="fa fa-refresh fa-spin fa-3x fa-fw"></i>',focus:!0,draggable:!1},this.doDelineate=!1,void this.startDelineate(t))},t.prototype.checkPRMSSegment=function(t){var r=this;return this.studyAreaService.getStudyArea(e.Models.StudyAreaType.e_segment).status==e.Models.StudyAreaStatus.e_ready?void(this.doQueryPRMSSegments=!1):(this.sm("Querying PRMS segment, Please wait...",e.Models.NotificationType.e_wait,"Query PRMS segment",!0,603,0),this.cursorStyle="wait",this.angulartics.eventTrack("explorationTools",{category:"Map",label:"queryStreamgages"}),void this.leafletData.getMap().then(function(a){r.leafletData.getLayers().then(function(n){try{if(a.getZoom()<=8)return r.cursorStyle="pointer",r.clrm(603),void r.sm("Please zoom to at least a zoom level of 9 to perform this operation",e.Models.NotificationType.e_warning,"Query PRMS segment");var o;n.overlays["PRMS Segments"].identify().on(a).at(t).returnGeometry(!0).tolerance(5).layers(o).run(function(t,a){if(r.clrm(603),!a.features||0==a.features.length)return void r.sm("No segments were found",e.Models.NotificationType.e_info,"Query PRMS segment");var n=r.studyAreaService.getStudyArea(e.Models.StudyAreaType.e_segment);a.features.forEach(function(t){var a=n.Scenarios[0];"LineString"===t.geometry.type&&(a.SelectedSegmentList.push({SegmentID:t.properties.GRID_CODE,RiverID:t.layerId,feature:t.geometry}),r.addGeoJSON("PRMSSeg_"+t.layerId+"."+t.properties.GRID_CODE,t.geometry),a.status=e.Models.ScenarioStatus.e_loaded)}),n.status=e.Models.StudyAreaStatus.e_initialized})}catch(i){console.log("error",i)}finally{r.cursorStyle="pointer",r.clrm(603)}})}))},t.prototype.basinEditor=function(){var t=this;if(this.geojson.globalwatershed.data.features.length>1)return void this.sm("You cannot edit a global watershed",e.Models.NotificationType.e_warning,"Edit Watershed");var r=angular.fromJson(angular.toJson(this.geojson.globalwatershed.data.features[0])),a=[];r.geometry.coordinates[0].forEach(function(e){a.push([e[1],e[0]])}),this.leafletData.getMap().then(function(e){t.leafletData.getLayers().then(function(n){var o=n.overlays.draw;o.clearLayers();var i=new L.Draw.Polygon(e,o);i.enable(),e.on("draw:created",function(n){e.removeEventListener("draw:created");var i=n.layer;o.addLayer(i);var s=i.toGeoJSON().geometry.coordinates[0],u=[];s.forEach(function(e){u.push([e[1],e[0]])});L.polygon(a),L.polygon(u);r.geometry.coordinates[0]=[],t.geojson.globalwatershed.data.features[0]=r,o.clearLayers()})})})},t.prototype.addGeoJSON=function(t,r){var a=this;if("globalwatershed"==t)this.geojson[t]={data:r,style:{displayName:"Basin Boundary",imagesrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA0ZJREFUeNqslN1PXEUUwO9fadKy7C67y7IfXRZQaloLFdJooi9VJNXy5EfSBzWx7z7ZFz9jjKYxVWsQ2F3unZkzZ+YCmgI/H+5CW/sk8PDLnJxkfjOZM+ckudbItUHuW+S+S/Q9ou+P1y5RO0RtjekUeZknuqtEmUdjjbg/SdgrY/0lrL2E9yVUKyS5Nsi1+R/5mBNxaD7l2QN8H+tqiFZxvoKVKuob7OXFZZITcbGp+4JYYwONNTROjakVudBCQwdjmjjXwbkrWNPDyzx5eBWVqyRR2kRpE6TzPH4Gr9P4MIUPVXws42MJH0tILBe5UEd8ixBmCbqAM/PYdBGxy4hZIXlBKh2Cb+P1qVxiFYllJC8heQm3d/k0tloiHkyTH1zBull2RwtYs8peWCdR1+YUaaHSQnwL8U2cntDAaQMbathQJYtVbKxg4yQj9xISq2jexrg+WbpEDOtw9AVJIWyeIr5ZyKWN812c9LEyh5U5Mj9H5vuk2iPTLllokUoFo3WMzJLa64Rwm+Ojz4GvSdQ3KKghWkN8A+dbOOlh5RWsu0Zmb5KZW6T2FqldZeReJ3U3SeU1rF4jtdcZ7a6QZe/w9/5nwDfAI5IYaogrY1wJ0aJIxs2QZX2MucFgaxWTrhH0Q5x8zGh3g63BOtuDNXaG7zEabPDXn3fZ2fyIff8lHD+Ew8cASRLjFCITGLmMaAUJdYxrk5lFsuxN4D7wFfAD8NOYH4Hvx7lfgEfA78A2HKUACZAkIZQRmcD6CUQrOG1gbI8sXcKad4EHwM9w9Bs82YTDTWAT+AN4XMTHm3C4A/8MT8VjeRWRyWfkTVLTIzUrOLsBfPfchv9DErSOlymcr+BDHSszpGaezLyByifFrc8qV2ni3XTxU8I0xs0wzBYw5i1U7wEPzyF3Xbwtmka0jXFthtnLWPs2MX4K/HqOZ7E91HXHs2SGzLUZposYe5sY7o8Ld0b5vptHsiYxNLBSRWIXp8vsDNc4fPIA2Dqf3JsZ9kIdK5NI7GLDMoPhHQ4PvwUGFys3usRgeIfj4wuS78cGViZxoYPRJYaj98dduHN2+Z6dQ22Lg3wa58tYbZP5G4x2Pxi3+fbFy3fTu+M5cvaC/jsAOPZsktORyooAAAAASUVORK5CYII=",fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}};else if("globalwatershedpoint"==t){var n=this.studyAreaService.getStudyArea(e.Models.StudyAreaType.e_basin),o=n.Pourpoint.Latitude,i=n.Pourpoint.Longitude,s=(n.RegionID,n.WorkspaceID);r.features[0].properties;this.geojson[t]={data:r,onEachFeature:function(e,t){var r="         <div>";r+="        <strong>Latitude: </strong>"+o,r+="        <br />",r+="        <strong>Longitude: </strong>"+i,r+="        <br />",r+="        <strong>WorkspaceID: </strong>"+s,r+="        <br />",angular.forEach(e.properties,function(e,t){r+="<strong>"+t+": </strong>"+e+"<br />"}),r+='       <button class="btn-wim-sm btn-wim-danger" ng-click=" vm.removeStudyArea()"><i class=\'fa fa-close\'></i>  Remove Study Area</button>',r+="        </div>";var n=a.$compile(r),u=n(a.$scope);t.bindPopup(u[0])},style:{displayName:"Basin Clicked Point",imagesrc:"data:image/png;base64,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",visible:!0}}}else this.geojson[t]={data:r,onEachFeature:function(e,r){r.bindLabel(t,{noHide:!0})}}},t.prototype.removeGeoJson=function(e,t){var r=this;void 0===e&&(e=""),void 0===t&&(t=!1);var a;a=this.getLayerIdsByID(e,this.geojson,t),a.forEach(function(e){delete r.geojson[e],r.eventManager.RaiseEvent(WiM.Directives.onLayerRemoved,r,new WiM.Directives.LegendLayerRemovedEventArgs(e,"geojson"))})},t.prototype.addOverlayLayers=function(e,t){this.layers.overlays[e]=t},t.prototype.removeOverlayLayers=function(e,t){var r=this;void 0===t&&(t=!1);var a;a=this.getLayerIdsByID(e,this.layers.overlays,t),a.forEach(function(e){delete r.layers.overlays[e]})},t.prototype.getLayerIdsByName=function(e,t,r){var a=[];for(var n in t)t[n].hasOwnProperty("name")&&(r?t[n].name.indexOf(e)>-1:t[n].name===e)&&a.push(n);return a},t.prototype.getLayerIdsByID=function(e,t,r){var a=[];for(var n in t)(r?n.indexOf(e)>-1:n===e)&&a.push(n);return a},t.prototype.startDelineate=function(t){var r=this.studyAreaService.getStudyArea(e.Models.StudyAreaType.e_basin);r.RegionID="IA",r.Pourpoint=new WiM.Models.Point(t.lat,t.lng,"4326"),this.studyAreaService.initializeStudyArea(e.Models.StudyAreaType.e_basin)},t.prototype.sm=function(t,r,a,n,o,i){void 0===a&&(a=""),void 0===n&&(n=!1),void 0===o&&(o=null),void 0===i&&(i=5e3),this.toaster.pop(new e.Models.Notification(t,r,a,n,i,o))},t.prototype.clrm=function(e){void 0===e&&(e=null),this.toaster.clear()},t.prototype.onSelectedStudyAreaChanged=function(e,t){var r=this;t.studyArea.Features.forEach(function(e){r.removeGeoJson(e.name),r.addGeoJSON(e.name,e.feature),r.eventManager.RaiseEvent(WiM.Directives.onLayerAdded,r,new WiM.Directives.LegendLayerAddedEventArgs(e.name,"geojson",r.geojson[e.name].style))}),this.markers={};var a=this.geojson.globalwatershed.data.features[0].bbox;this.leafletData.getMap().then(function(e){e.fitBounds([[a[1],a[0]],[a[3],a[2]]],{})}),this.clrm()},t.prototype.onSelectedAreaOfInterestChanged=function(e,t){this.angulartics.eventTrack("Search",{category:"Sidebar"}),this.markers={};var r=t.selectedAreaOfInterest;if("U.S. State or Territory"==r.Category)var a=9;else var a=14;this.markers.AOI={lat:r.Latitude,lng:r.Longitude,message:r.Name,focus:!0,draggable:!1},this.leafletData.getMap().then(function(e){e.setView([r.Latitude,r.Longitude],a)})},t.prototype.onLayerChanged=function(e,t){if("visible"===t.PropertyName)if(t.Value)for(var r=this.studyAreaService.getstudyAreaFeatures(t.LayerName),a=0;a<r.length;a++){var n=r[a];n.name==t.LayerName&&this.addGeoJSON(t.LayerName,n.feature)}else delete this.geojson[t.LayerName]},t.prototype.onStudyAreaDoInit=function(t,r){var a=r.studyArea;switch(a.studyAreaType){case e.Models.StudyAreaType.e_basin:this.addOverlayLayers("Stream Grid",configuration.regions.IA.sgrid),this.doDelineate=!0,this.doQueryPRMSSegments&&(this.doQueryPRMSSegments=!1);break;case e.Models.StudyAreaType.e_segment:this.addOverlayLayers("PRMS Segments",configuration.regions.IA.PRMS),this.doQueryPRMSSegments=!0,this.doDelineate&&(this.doDelineate=!1)}},t.$inject=["$scope","$compile","$analytics","$location","$stateParams","leafletBoundsHelpers","leafletData","WiM.Services.SearchAPIService","StreamEst.Services.StudyAreaService","StreamEst.Services.ExplorationService","WiM.Event.EventManager","toaster"],t}();angular.module("StreamEst.Controllers").controller("StreamEst.Controllers.MapController",o)}(t=e.Controllers||(e.Controllers={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(t){"use strinct";var r,a=function(){function t(e,t,a,n,o,i,s,u){this.EventManager=s,this.toaster=u,e.vm=this,this.init(),this.angulartics=t,this.searchService=a,this.sideBarCollapsed=!1,this.selectedProcedure=r.SCENARIO,this.studyAreaService=n,this.isLoadingScenarios=!1,this._isBuildingReport=!1,this.modalService=o,this.explorationService=i,this.dateRange={dates:{startDate:this.addDay(new Date,-1),endDate:this.addDay(new Date,-1)},minDate:new Date(1900,1,1),maxDate:this.addDay(new Date,-1)}}return Object.defineProperty(t.prototype,"ScenariosSelected",{get:function(){var e=this.studyAreaService.studyAreas;if(0===Object.keys(e).length)return!1;for(var t in e)if(e[t].Scenarios.length>0)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"StudyAreasInitialized",{get:function(){var t=this.studyAreaService.studyAreas;if(0===Object.keys(t).length)return!1;for(var r in t)if(t[r].status<e.Models.StudyAreaStatus.e_initialized)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ScenariosReady",{get:function(){var t=this.studyAreaService.studyAreas;if(0===Object.keys(t).length)return!1;for(var r in t){if(t[r].status!=e.Models.StudyAreaStatus.e_ready)return!1;for(var a=0;a<t[r].Scenarios.length;a++)if(t[r].Scenarios[a].status<=e.Models.ScenarioStatus.e_initialized)return!1}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedParameters",{get:function(){this.studyAreaService.getStudyArea(e.Models.StudyAreaType.e_basin);return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBuildingReport",{get:function(){return this._isBuildingReport},enumerable:!0,configurable:!0}),t.prototype.getLocations=function(e){return this.searchService.getLocations(e)},t.prototype.loadSelectedScenarios=function(){var t=this;this.sm("Loading Scenarios. Please wait...",e.Models.NotificationType.e_wait,"Loading Scenarios",!0,151,0),this.isLoadingScenarios=!0;var a=new WiM.Event.EventHandler(function(n,o){t.isLoadingScenarios=!1,t.EventManager.UnSubscribeToEvent(e.Services.onStudyAreaLoadComplete,a),t.setProcedureType(r.REPORT),t.clrm(),t.sm("Finished Loading Scenarios, continue by configuring the report and selecting continue.",e.Models.NotificationType.e_success,"Loading Scenarios")});this.EventManager.SubscribeToEvent(e.Services.onStudyAreaLoadComplete,a),this.studyAreaService.loadScenarios()},t.prototype.setProcedureType=function(e){this.selectedProcedure!=e&&this.canUpdateProcedure(e)&&(this.selectedProcedure=e)},t.prototype.toggleSideBar=function(){this.sideBarCollapsed?this.sideBarCollapsed=!1:this.sideBarCollapsed=!0},t.prototype.startSearch=function(e){e.stopPropagation(),e.preventDefault(),$("#sapi-searchTextBox").trigger($.Event("keyup",{keyCode:13}))},t.prototype.StudyAreaContainsScenario=function(e,t){var r=this.studyAreaService.getStudyArea(e);if(null==r)return!1;for(var a=0;a<r.Scenarios.length;a++)if(angular.equals(r.Scenarios[a],t))return!0;return!1},t.prototype.selectScenario=function(t){return this.isLoadingScenarios?void this.sm("Busy Loading parameters.. Please wait.",e.Models.NotificationType.e_warning,"Warning"):void(this.studyAreaService.scenarioExists(t)?this.studyAreaService.removeScenario(t):this.studyAreaService.addScenario(t))},t.prototype.showEditableReport=function(){this.modalService.openModal(e.Services.SSModalType.e_report,{editable:!0})},t.prototype.generateReport=function(){var t=this;if(this.verifySceneriosCanExecute()&&!this.studyAreaService.isBusy){this._isBuildingReport=!0;var r=new WiM.Event.EventHandler(function(a,n){t.modalService.openModal(e.Services.SSModalType.e_report),t.EventManager.UnSubscribeToEvent(e.Services.onStudyAreaExcecuteComplete,r),t._isBuildingReport=!1});this.EventManager.SubscribeToEvent(e.Services.onStudyAreaExcecuteComplete,r),this.studyAreaService.computeScenarios(this.dateRange.dates.startDate,this.dateRange.dates.endDate)}},t.prototype.getPRMSRiverName=function(e){return this.studyAreaService.prmsNameLookup[e]},t.prototype.resetStudyArea=function(e){var t=this,r=this.studyAreaService.getStudyArea(e);return null==r?!1:(r.Features.forEach(function(e){t.EventManager.RaiseEvent(WiM.Directives.onLayerChanged,t,new WiM.Directives.LegendLayerChangedEventArgs(e.name,"visible",!1))}),void delete this.studyAreaService.studyAreas[e])},t.prototype.init=function(){this.AvailableScenarios=[new e.Models.FDCTMScenario,new e.Models.FAScenario,new e.Models.PRMSScenario]},t.prototype.canUpdateProcedure=function(t){try{switch(t){case r.SEARCH:return!0;case r.SCENARIO:return!0;case r.REPORT:if(this.isLoadingScenarios)return this.sm("Loading scenario parameters please wait.",e.Models.NotificationType.e_warning,"Warning"),!1;if(!this.ScenariosSelected)return this.sm("You must first select a scenario to continue.",e.Models.NotificationType.e_warning,"Warning"),!1;if(!this.StudyAreasInitialized){var a=this.studyAreaService.studyAreas;0===Object.keys(a).length&&this.sm("There are no study areas. First select a scenario.",e.Models.NotificationType.e_warning,"Warning");for(var n in a)a[n].status==e.Models.StudyAreaStatus.e_empty&&this.sm("There is no study area initialized. Select a location to add a study area.",e.Models.NotificationType.e_warning,"Warning"),a[n].status==e.Models.StudyAreaStatus.e_initialized&&this.sm("Study area is initialized. Please wait....",e.Models.NotificationType.e_warning,"Warning"),a[n].status==e.Models.StudyAreaStatus.e_error&&this.sm("There was an error while initializing the study area. Please try again.",e.Models.NotificationType.e_warning,"Warning");return!1}return this.ScenariosReady?!0:(this.sm("You must first load the scenarios to continue.",e.Models.NotificationType.e_warning,"Warning"),!1);default:return!1}}catch(o){return!1}},t.prototype.verifySceneriosCanExecute=function(){return(this.dateRange.dates.startDate<=this.dateRange.maxDate||this.dateRange.dates.endDate<=this.dateRange.maxDate)&&(this.dateRange.dates.startDate>=this.dateRange.minDate||this.dateRange.dates.endDate>=this.dateRange.minDate)&&this.dateRange.dates.startDate<=this.dateRange.dates.endDate?this.studyAreaService.verifyScenariosStatus(e.Models.ScenarioStatus.e_initialized)?!0:(this.sm("Scenarios are not initialized.",e.Models.NotificationType.e_error,"Error",!0),!1):(this.sm("Dates are out of range.",e.Models.NotificationType.e_error,"Error",!0),!1)},t.prototype.addDay=function(e,t){try{var r=864e5;return new Date(e.getTime()+t*r)}catch(a){return e}},t.prototype.sm=function(t,r,a,n,o,i){void 0===a&&(a=""),void 0===n&&(n=!1),void 0===o&&(o=null),void 0===i&&(i=5e3),this.toaster.pop(new e.Models.Notification(t,r,a,n,i,o))},t.prototype.clrm=function(e){void 0===e&&(e=null),this.toaster.clear(e)},t.$inject=["$scope","$analytics","WiM.Services.SearchAPIService","StreamEst.Services.StudyAreaService","StreamEst.Services.ModalService","StreamEst.Services.ExplorationService","WiM.Event.EventManager","toaster"],t}();!function(e){e[e.SEARCH=1]="SEARCH",e[e.SCENARIO=2]="SCENARIO",e[e.REPORT=4]="REPORT"}(r||(r={})),angular.module("StreamEst.Controllers").controller("StreamEst.Controllers.SidebarController",a)}(t=e.Controllers||(e.Controllers={}))}(StreamEst||(StreamEst={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},StreamEst;!function(e){var t;!function(t){"use strict";var r=function(t){function r(r,a,n){t.call(this,a,configuration.baseurls.StreamEstServices),r.vm=this,this.modalService=n,this.modalService.openModal(e.Services.SSModalType.e_about,{tabName:"disclaimer"})}return __extends(r,t),r.prototype.openReport=function(){this.modalService.openModal(e.Services.SSModalType.e_report)},r.prototype.openAbout=function(){this.modalService.openModal(e.Services.SSModalType.e_about)},r.prototype.readCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),a=0;a<r.length;a++){for(var n=r[a];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null},r.prototype.createCookie=function(e,t,r){if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3);var n="; expires="+a.toUTCString()}else var n="";document.cookie=e+"="+t+n+"; path=/"},r.$inject=["$scope","$http","StreamEst.Services.ModalService"],r}(WiM.Services.HTTPServiceBase);angular.module("StreamEst.Controllers").controller("StreamEst.Controllers.NavbarController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(t){"use strinct";var r=function(){function e(e,t,r){this.lat=e,this.lng=t,this.zoom=r}return e}(),a=function(){function t(e,t,r,a,n,o,i){var s=this;this.markers=null,this.overlays=null,this.center=null,this.layers=null,e.vm=this,this.$timeout=t,this.angulartics=r,this.studyAreaService=n,this.leafletData=o,this.citations=[],null!=i.modalOptions&&null!=i.modalOptions.editable&&(this._canEdit=i.modalOptions.editable),this.selectedGraphData=[],this.init(),e.$on("leafletDirectiveMap.load",function(e,t){s.showFeatures()}),this.close=function(){a.dismiss("cancel")},this.print=function(){window.print()}}return Object.defineProperty(t.prototype,"StudyAreasReady",{get:function(){var t=this.studyAreaService.studyAreas;if(0===Object.keys(t).length)return!1;for(var r in t)if(t[r].status!=e.Models.StudyAreaStatus.e_ready)return!1;return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"studyAreaParametersReady",{get:function(){var t=this.studyAreaService.getStudyArea(e.Models.StudyAreaType.e_basin);return null==t?!1:t.computedParametersList.length<1?!1:!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"studyAreaParameters",{get:function(){var t=this.studyAreaService.getStudyArea(e.Models.StudyAreaType.e_basin);return null==t?null:t.computedParametersList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reportDate",{get:function(){return new Date},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"startDate",{get:function(){return new Date},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endDate",{get:function(){return new Date},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scenarioFlows",{get:function(){return this._scenarioFlows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canEdit",{get:function(){return this._canEdit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableTabNames",{get:function(){return this._availableTabNames},enumerable:!0,configurable:!0}),t.prototype.selectTab=function(e){this.selectedTabName!=e&&(this.selectedTabName=e,this.loadGraphData(e),this.availableTabNames.indexOf(e)<0||(this.selectedScenario=this.getScenarioByName(e)))},t.prototype.selectSecondaryTab=function(e){this.selectedSecondaryTabName!=e&&(this.selectedSecondaryTabName=e)},t.prototype.refreshParameter=function(e){e.isbusy=!0,this.studyAreaService.refreshParameter(e)},t.prototype.downloadCSV=function(){this.angulartics.eventTrack("Download",{category:"Report",label:"CSV"})},t.prototype.downloadGeoJSON=function(){},t.prototype.downloadPDF=function(){var e=new jsPDF("p","pt","letter"),t=document.getElementById("printArea").innerHTML,r={"#bypassme":function(e,t){return!0}},a={top:80,bottom:60,left:40,width:522};e.fromHTML(t,a.left,a.top,{width:a.width,elementHandlers:r},function(t){e.save("Test.pdf")},a)},t.prototype.loadScenario=function(e){console.log(e)},t.prototype.getPRMSRiverName=function(e){return this.studyAreaService.prmsNameLookup[e]},t.prototype.removePRMSsegment=function(e){this.studyAreaService.removePRMSSegment(e),this.showFeatures()},t.prototype.initMap=function(){this.center=new r(42,-93,8),this.layers={baselayers:configuration.basemaps,overlays:{}},this.geojson={},L.Icon.Default.imagePath="images",this.defaults={scrollWheelZoom:!1,touchZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}},t.prototype.init=function(){var t=this,r=this.studyAreaService.studyAreas;if(this._availableTabNames=[],this._scenarioFlows=[],0!=Object.keys(r).length)for(var a in r)r[a].Scenarios.forEach(function(r){
(r.status>e.Models.ScenarioStatus.e_initialized||r.status==e.Models.ScenarioStatus.e_error)&&t._availableTabNames.push(r.code.toLowerCase()),t.loadScenarioFlow(r)&&t._availableTabNames.push("flow")});this.reportTitle="StreamEst Report",this.selectedTabName="studyarea",this.initMap(),this.LoadCitations()},t.prototype.loadScenarioFlow=function(t){var r=this;try{if(t.status!=e.Models.ScenarioStatus.e_complete&&!t.result.hasOwnProperty("EstimatedFlow"))return!1;switch(t.code.toLowerCase()){case"fdctm":case"fla":this._scenarioFlows.push(t.result.EstimatedFlow);break;case"prms":if(0===Object.keys(t.result.EstimatedFlow).length)return;for(var a in t.result.EstimatedFlow)t.result.EstimatedFlow[a].forEach(function(e){r._scenarioFlows.push(e)})}return!0}catch(n){return console.log("False due to catch"),!1}},t.prototype.LoadCitations=function(){this.citations=Citations},t.prototype.showFeatures=function(){var t=this;this.overlays={},this.geojson={};var r=this.studyAreaService.studyAreas;if(0!==Object.keys(r).length)for(var a in r)r[a].status==e.Models.StudyAreaStatus.e_ready&&r[a].Features.forEach(function(e){if("globalwatershed"==e.name){t.layers.overlays[e.name]={name:"Basin Boundary",type:"geoJSONShape",data:e.feature,visible:!0,layerOptions:{style:{fillColor:"yellow",weight:2,opacity:1,color:"white",fillOpacity:.5}}};var r=t.layers.overlays[e.name].data.features[0].bbox;t.leafletData.getMap().then(function(e){e.invalidateSize(),e.fitBounds([[r[1],r[0]],[r[3],r[2]]])})}else"globalwatershedpoint"==e.name?t.layers.overlays[e.name]={name:"Basin Clicked Point",type:"geoJSONShape",data:e.feature,visible:!0}:t.geojson[e.name]={data:e.feature,onEachFeature:function(t,r){r.bindLabel(e.name,{noHide:!0})}}})},t.prototype.getScenarioByName=function(e){var t=this.studyAreaService.studyAreas;if(0!=Object.keys(t).length)for(var r in t)for(var a=0;a<t[r].Scenarios.length;a++)if(t[r].Scenarios[a].code.toLowerCase()===e)return t[r].Scenarios[a]},t.prototype.loadGraphData=function(e){var t,r=[];switch(e){case"fdctm":this.setGraphOption(e);var a=this.getScenarioByName(e);if(t=[],!a.result)return;for(var n in a.result.ExceedanceProbabilities)t.push({label:n,value:a.result.ExceedanceProbabilities[n]});r.push({values:t,area:!0,color:"#7777ff"});break;case"flow":this.setGraphOption(e),this.scenarioFlows.forEach(function(e){t=e.Observations.map(function(e){return{x:new Date(e.Date).getTime(),y:e.Value}}),r.push({key:e.Name,values:t})})}this.selectedGraphData=r,this.$timeout(function(){window.dispatchEvent(new Event("resize"))},200)},t.prototype.setGraphOption=function(e){switch(e){case"fdctm":this.selectedGraphOption={chart:{type:"lineChart",height:450,margin:{top:20,right:30,bottom:60,left:65},x:function(e){return e.label},y:function(e){return e.value},showLegend:!1,valueFormat:function(e){return d3.format(",.3f")(e)},xAxis:{showMaxMin:!1},yAxis:{axisLabel:"Discharge (CFS)",tickFormat:function(e){return d3.format(",.0f")(e)},tickValues:[1,10,100,1e3,1e4,1e6]},yScale:d3.scale.log(),title:{enable:!0,text:"Flow Duration Curve Transfer Method Model Estimated Exceedance Probabilities"}}};break;case"flow":this.selectedGraphOption={chart:{type:"lineChart",height:450,margin:{top:20,right:20,bottom:50,left:75},x:function(e){return new Date(e.x).getTime()},y:function(e){return e.y},useInteractiveGuideline:!1,interactive:!1,tooltips:!0,xAxis:{tickFormat:function(e){return d3.time.format("%x")(new Date(e))},rotateLabels:30,showMaxMin:!1},yAxis:{axisLabel:"Estimated Discharge (cfs)",tickFormat:function(e){return d3.format(".02f")(e)},showMaxMin:!1},zoom:{enabled:!0,scaleExtent:[1,10],useFixedDomain:!1,useNiceScale:!1,horizontalOff:!1,verticalOff:!1,unzoomEventType:"dblclick.zoom"}}}}},t.$inject=["$scope","$timeout","$analytics","$modalInstance","StreamEst.Services.StudyAreaService","leafletData","StreamEst.Services.ModalService"],t}();angular.module("StreamEst.Controllers").controller("StreamEst.Controllers.ReportController",a)}(t=e.Controllers||(e.Controllers={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(e){"use string";var t=function(){function e(e,t,r){e.vm=this,this.modalInstance=t,this.modalService=r,this.citations=[],this.init()}return e.prototype.Close=function(){this.modalService.modalOptions=null,this.modalInstance.dismiss("cancel")},e.prototype.selectAboutTab=function(e){this.selectedAboutTabName!=e&&(this.selectedAboutTabName=e)},e.prototype.openCitationLink=function(e){window.open(e.src,"_blank")},e.prototype.init=function(){null!=this.modalService.modalOptions&&""!=this.modalService.modalOptions.tabName?this.selectAboutTab(this.modalService.modalOptions.tabName):this.selectedAboutTabName="about",this.LoadCitations()},e.prototype.LoadCitations=function(){this.citations=Citations},e.$inject=["$scope","$modalInstance","StreamEst.Services.ModalService"],e}();angular.module("StreamEst.Controllers").controller("StreamEst.Controllers.AboutController",t)}(t=e.Controllers||(e.Controllers={}))}(StreamEst||(StreamEst={}));var StreamEst;!function(e){var t;!function(t){"use string";var r=function(){function t(e,t,r,a){e.vm=this,this.modalInstance=t,this.studyAreaService=a,this.eventManager=r,this.init()}return Object.defineProperty(t.prototype,"displayMessage",{get:function(){return this.selectedStudyAreaType==e.Models.StudyAreaType.e_basin?"A study area cannot be found. Please zoom into at least a zoom level of 15 and select on a blue stream grid to create a pourpoint to delineate.":this.selectedStudyAreaType==e.Models.StudyAreaType.e_segment?"A study area cannot be found. Please select one or more blue stream segment to continue.":void 0},enumerable:!0,configurable:!0}),t.prototype.OK=function(){var t=new e.Services.StudyAreaEventArgs;t.studyArea=this.studyAreaService.getStudyArea(this.selectedStudyAreaType),this.eventManager.RaiseEvent(e.Services.onStudyAreaDoInit,this,t),this.modalInstance.dismiss("cancel")},t.prototype.Cancel=function(){this.studyAreaService.removeStudyArea(this.selectedStudyAreaType),this.modalInstance.dismiss("cancel")},t.prototype.init=function(){for(var t in this.studyAreaService.studyAreas)if(this.studyAreaService.studyAreas.hasOwnProperty(t)&&this.studyAreaService.studyAreas[t].status==e.Models.StudyAreaStatus.e_empty){this.selectedStudyAreaType=this.studyAreaService.studyAreas[t].studyAreaType;break}},t.$inject=["$scope","$modalInstance","WiM.Event.EventManager","StreamEst.Services.StudyAreaService"],t}();angular.module("StreamEst.Controllers").controller("StreamEst.Controllers.SelectStudyAreaController",r)}(t=e.Controllers||(e.Controllers={}))}(StreamEst||(StreamEst={}));